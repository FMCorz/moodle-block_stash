define(["jquery","core/templates","block_stash/counselor","block_stash/item-dialogue","block_stash/drop"],function(a,b,c,d,e){function f(b){this._node=a(b),this._setUp()}return f.prototype._node=null,f.prototype._userItemTemplate="block_stash/user_item",f.prototype._setUp=function(){c.on(e.prototype.EVENT_PICKEDUP,this._dropPickedUpListener.bind(this)),this._setUpUserItemAreClickable()},f.prototype.addUserItem=function(c){return this._renderUserItem(c).then(function(d,e){var f=a(d),g=this._node.find(".item-list");f.data("useritem",c),this._makeUserItemNodeClickable(f),g.append(" "),g.append(f),b.runTemplateJS(e)}.bind(this))},f.prototype.containsItem=function(a){return this.getUserItemNode(a).length>0},f.prototype._dropPickedUpListener=function(a,b){var c=b.useritem;this.containsItem(c.getItem().get("id"))?this.updateUserItemQuantity(c):this.addUserItem(c).then(function(){this._node.find(".empty-content").remove()}.bind(this))},f.prototype.getUserItemNode=function(a){return this._node.find(".block-stash-item[data-id="+a+"]")},f.prototype._makeUserItemNodeClickable=function(a){a.attr("tabindex",0),a.attr("role","button"),a.attr("aria-haspopup","true")},f.prototype._renderUserItem=function(a){return b.render(this._userItemTemplate,{item:a.getItem().getData(),useritem:a.getData()})},f.prototype._setUpUserItemAreClickable=function(){this._node.find(".item-list .block-stash-item").each(function(b,c){this._makeUserItemNodeClickable(a(c))}.bind(this));var b=function(b){var c=a(b.currentTarget),e=c.data("id");if(e){var f=new d(e);b.preventDefault(),f.show(b)}},c='.block-stash-item[aria-haspopup="true"]';this._node.find(".item-list").delegate(c,"click",b),this._node.find(".item-list").delegate(c,"keydown",function(a){13!=a.keyCode&&32!=a.keyCode||b(a)})},f.prototype.updateUserItemQuantity=function(a){var b=this.getUserItemNode(a.getItem().get("id")),c=b.find(".item-quantity"),d=a.get("quantity"),e=parseInt(c.text(),10);c.text(d),b.removeClass("item-quantity-"+e),b.addClass("item-quantity-"+d)},f});